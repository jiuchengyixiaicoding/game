<!DOCTYPE html>
<html>
<head>
    <title>俄罗斯方块</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #2c3e50;
            color: white;
            font-family: Arial;
        }
        #game-board {
            display: grid;
            grid-template-columns: repeat(10, 30px);
            grid-template-rows: repeat(20, 30px);
            gap: 1px;
            background: #34495e;
            padding: 5px;
            border-radius: 5px;
        }
        .cell {
            width: 30px;
            height: 30px;
            background: #bdc3c7;
            transition: background 0.1s;
        }
        .controls {
            margin-top: 20px;
        }
        .I { background: #1abc9c; }
        .O { background: #f1c40f; }
        .T { background: #9b59b6; }
        .S { background: #2ecc71; }
        .Z { background: #e74c3c; }
        .J { background: #3498db; }
        .L { background: #e67e22; }
    </style>
</head>
<body>
    <h1>俄罗斯方块</h1>
    <div id="game-board"></div>
    <div class="controls">
        <div>得分: <span id="score">0</span></div>
        <button onclick="togglePause()">暂停/继续</button>
    </div>

    <script>
        const BOARD_WIDTH = 10;
        const BOARD_HEIGHT = 20;
        let board = Array(BOARD_HEIGHT).fill().map(() => Array(BOARD_WIDTH).fill(''));
        let currentPiece = null;
        let score = 0;
        let isPaused = false;
        let gameInterval;

        // 方块定义（网页2、4、6的综合方案）
        const TETROMINOES = {
            I: { shape: [[1,1,1,1]], className: 'I' },
            O: { shape: [[1,1],[1,1]], className: 'O' },
            T: { shape: [[0,1,0],[1,1,1]], className: 'T' },
            S: { shape: [[0,1,1],[1,1,0]], className: 'S' },
            Z: { shape: [[1,1,0],[0,1,1]], className: 'Z' },
            J: { shape: [[1,0,0],[1,1,1]], className: 'J' },
            L: { shape: [[0,0,1],[1,1,1]], className: 'L' }
        };

        // 初始化游戏（网页6方案）
        function initGame() {
            document.getElementById('game-board').innerHTML = '';
            board.forEach((row, y) => {
                row.forEach((cell, x) => {
                    const div = document.createElement('div');
                    div.className = `cell ${cell}`;
                    div.dataset.x = x;
                    div.dataset.y = y;
                    document.getElementById('game-board').appendChild(div);
                });
            });
            spawnNewPiece();
            gameInterval = setInterval(gameLoop, 1000);
        }

        // 生成新方块（网页2、4综合）
        function spawnNewPiece() {
            const types = Object.keys(TETROMINOES);
            const type = types[Math.floor(Math.random() * types.length)];
            currentPiece = {
                ...TETROMINOES[type],
                x: Math.floor(BOARD_WIDTH/2) - 1,
                y: 0
            };
            if (!canMove(0, 0)) gameOver();
        }

        // 移动检测（网页2核心算法）
        function canMove(offsetX, offsetY) {
            return currentPiece.shape.every((row, dy) => 
                row.every((cell, dx) => {
                    if (!cell) return true;
                    const newX = currentPiece.x + dx + offsetX;
                    const newY = currentPiece.y + dy + offsetY;
                    return newX >= 0 && newX < BOARD_WIDTH && 
                           newY < BOARD_HEIGHT && 
                           !board[newY]?.[newX];
                })
            );
        }

        // 游戏主循环（网页6方案优化）
        function gameLoop() {
            if (isPaused) return;
            
            if (canMove(0, 1)) {
                currentPiece.y++;
            } else {
                lockPiece();
                clearLines();
                spawnNewPiece();
            }
            drawBoard();
        }

        // 锁定方块（网页4逻辑）
        function lockPiece() {
            currentPiece.shape.forEach((row, dy) => {
                row.forEach((cell, dx) => {
                    if (cell) {
                        const y = currentPiece.y + dy;
                        const x = currentPiece.x + dx;
                        if (y >= 0) board[y][x] = currentPiece.className;
                    }
                });
            });
        }

        // 消除行（网页2、6算法结合）
        function clearLines() {
            let linesCleared = 0;
            for (let y = BOARD_HEIGHT - 1; y >= 0; y--) {
                if (board[y].every(cell => cell)) {
                    board.splice(y, 1);
                    board.unshift(Array(BOARD_WIDTH).fill(''));
                    linesCleared++;
                }
            }
            if (linesCleared) {
                score += linesCleared * 100;
                document.getElementById('score').textContent = score;
            }
        }

        // 绘制游戏板（网页2、4综合）
        function drawBoard() {
            document.querySelectorAll('.cell').forEach(cell => {
                const x = parseInt(cell.dataset.x);
                const y = parseInt(cell.dataset.y);
                cell.className = `cell ${board[y][x] || ''}`;
            });
        }

        // 键盘控制（网页3、6事件处理）
        document.addEventListener('keydown', e => {
            if (isPaused) return;
            switch(e.key) {
                case 'ArrowLeft': 
                    if (canMove(-1, 0)) currentPiece.x--;
                    break;
                case 'ArrowRight': 
                    if (canMove(1, 0)) currentPiece.x++;
                    break;
                case 'ArrowDown': 
                    if (canMove(0, 1)) currentPiece.y++;
                    break;
                case 'ArrowUp': 
                    rotatePiece();
                    break;
            }
            drawBoard();
        });

        // 旋转方块（网页2旋转算法优化）
        function rotatePiece() {
            const rotated = currentPiece.shape[0].map((_, i) =>
                currentPiece.shape.map(row => row[i]).reverse()
            );
            const originalShape = currentPiece.shape;
            currentPiece.shape = rotated;
            if (!canMove(0, 0)) currentPiece.shape = originalShape;
        }

        function togglePause() {
            isPaused = !isPaused;
            document.querySelector('button').textContent = isPaused ? '继续' : '暂停';
        }

        function gameOver() {
            clearInterval(gameInterval);
            alert(`游戏结束！得分: ${score}`);
            location.reload();
        }

        // 启动游戏
        initGame();
    </script>
</body>
